const{__:e}=wp.i18n,t=({label:t,icon:a,showWrapper:s=!0,renderAsLink:n=!0,href:r,text:c,status:i="default",openInNewWindow:l=!0})=>{const o=c||e("Get Pro","arts-license-pro"),p=`arts-license-pro-badge${"default"!==i?` arts-license-pro-badge_${i}`:""}`,d=n&&r?React.createElement("a",{href:r,className:p,...l&&{target:"_blank",rel:"noopener noreferrer"}},o):React.createElement("span",{className:p},o);return s?React.createElement("span",{className:"arts-license-pro-badge-wrapper"},a&&React.createElement("span",{className:`dashicons ${a}`}),t&&React.createElement("span",{className:"arts-license-pro-badge-wrapper__label"},t),d):d},{useState:a,useEffect:s}=wp.element,{Button:n,TextControl:r}=wp.components,{dateI18n:c}=wp.date,{__:i}=wp.i18n;function l({onActivate:e,onDeactivate:l,onRefresh:o,isLoading:p,licenseKey:d,isActivated:u,license:h,apiError:m,licenseConfig:f,shouldRefreshPageOnLicenseChange:_=!1,shouldAutoRefreshLicenseOnMount:w=!1}){const[g,v]=a(d||""),[y,E]=a(null),[R,L]=a(!1),[X,k]=a(!1);s((()=>{w&&u&&A()}),[]);const A=async()=>{k(!0);try{await o()}catch(e){L(!0)}finally{k(!1)}},b=async()=>{const t=(a=g)&&0!==a.trim().length?null:i("License key is required","arts-license-pro");var a;if(t)E(t);else{E(null);try{await e(g),_&&window.location.reload()}catch(e){L(!0)}}},N=e=>React.createElement("span",{className:"arts-license-pro-error"},React.createElement("span",{className:"arts-license-pro-error__icon"},"✕"),e);let S=null;if(y)S=N(y);else if(R&&m)S=N(m);else if(u&&h){const e=[],a=h.is_local?i("Activated (staging domain)","arts-license-pro"):i("Activated","arts-license-pro");if(e.push(React.createElement("li",{key:"status"},React.createElement("div",{className:"arts-license-pro-status-badge arts-license-pro-status-badge_valid "+(X?"arts-license-pro-status-badge_refreshing":"arts-license-pro-status-badge_clickable"),onClick:X?void 0:A,title:X?"":i("Click to refresh","arts-license-pro")},React.createElement("span",{className:"arts-license-pro-status-badge__icon"},X?"⟳":"✓"),React.createElement("span",{className:"arts-license-pro-status-badge__text"},X?i("Checking license...","arts-license-pro"):a)))),h.date_purchased){const t=h.date_purchased.split(" ")[0]||h.date_purchased,a=c("M d, Y",t);e.push(React.createElement("li",{key:"purchased"},"✓ ",i("Purchased on","arts-license-pro")," ",a))}if(h.date_supported_until){const a=h.date_supported_until.split(" ")[0]||h.date_supported_until,s=new Date(a),n=new Date;n.setHours(0,0,0,0);const r=s<n,l=c("M d, Y",a),o=r?"warning":"success",p=r?f.renewSupportUrl:f.supportUrl,d=i(r?"Renew Support":"Get Support","arts-license-pro");r?e.push(React.createElement("li",{key:"support",className:"arts-license-pro-error"},React.createElement("span",{className:"arts-license-pro-error__icon"},"✕"),i("Support Expired Since","arts-license-pro")," ",l," ",React.createElement(t,{showWrapper:!1,renderAsLink:!0,href:p,text:d,status:o}))):e.push(React.createElement("li",{key:"support"},"✓ ",i("Supported Until","arts-license-pro")," ",l," ",React.createElement(t,{showWrapper:!1,renderAsLink:!0,href:p,text:d,status:o})))}if(h.date_updates_provided_until)if("lifetime"===h.date_updates_provided_until)e.push(React.createElement("li",{key:"updates"},"✓ ",i("Lifetime Updates","arts-license-pro")));else{const t=h.date_updates_provided_until.split(" ")[0]||h.date_updates_provided_until,a=new Date(t),s=new Date;s.setHours(0,0,0,0);const n=a<s,r=c("M d, Y",t);n?e.push(React.createElement("li",{key:"updates",className:"arts-license-pro-error"},React.createElement("span",{className:"arts-license-pro-error__icon"},"✕"),i("Updates Expired on","arts-license-pro")," ",r)):e.push(React.createElement("li",{key:"updates"},"✓ ",i("Updates Provided Till","arts-license-pro")," ",r))}if(h.expires&&("lifetime"===h.expires?e.push(React.createElement("li",{key:"expires"},"✓ ",i("Lifetime License","arts-license-pro"))):e.push(React.createElement("li",{key:"expires"},"✓ ",i("Expires","arts-license-pro"),": ",h.expires))),void 0!==h.site_count&&void 0!==h.license_limit){0===Number(h.license_limit)||"unlimited"===h.activations_left?e.push(React.createElement("li",{key:"activations"},"✓ ",i("Unlimited Activations","arts-license-pro"))):e.push(React.createElement("li",{key:"activations"},"✓ ",i("Activations","arts-license-pro"),": ",h.site_count,"/",h.license_limit))}S=React.createElement("div",{className:"arts-license-pro-info"},React.createElement("ul",{className:"arts-license-pro-info__list"},e))}else S=React.createElement("span",null,i("Enter Your License Key","arts-license-pro"),"."," ",React.createElement(t,{showWrapper:!1,renderAsLink:!0,href:f.purchaseUrl,text:i("Get License Key","arts-license-pro")}));return React.createElement("div",{className:"arts-license-pro-form"},React.createElement("div",{className:"arts-license-pro-form__input-wrapper"},React.createElement(r,{value:g,onChange:e=>{v(e),E(null),L(!1)},onKeyDown:e=>{"Enter"===e.key&&!u&&g.trim()&&(e.preventDefault(),b())},placeholder:"XXXXXXXX-XXXXXXXX-XXXXXXXX-XXXXXXXX",help:S,className:y||R&&m?"has-error":"",disabled:p||X||u,readOnly:u}),React.createElement(n,{variant:u?"secondary":"primary",type:"button",onClick:u?async()=>{if(confirm(i("Are you sure you want to deactivate this license?","arts-license-pro")))try{await l(),v(""),_&&window.location.reload()}catch(e){L(!0)}}:b,isBusy:p||X,disabled:p||X||!u&&!g.trim(),isDestructive:u&&!X,className:"arts-license-pro-form__button"},i(X?"Refreshing...":p?u?"Deactivating...":"Activating...":u?"Deactivate":"Activate","arts-license-pro"))))}const{useState:o}=wp.element;function p(e){const[t,a]=o(e.initialLicense),[s,n]=o(!1),[r,c]=o(null);return{license:t,isLoading:s,error:r,activateLicense:async t=>{n(!0),c(null);try{const s=await e.api.activate(t);a(s)}catch(e){const t=e instanceof Error?e.message:"Activation failed";throw c(t),e}finally{n(!1)}},deactivateLicense:async()=>{n(!0),c(null);try{await e.api.deactivate(),a(null)}catch(e){const t=e instanceof Error?e.message:"Deactivation failed";throw c(t),e}finally{n(!1)}},refreshLicense:async()=>{n(!0),c(null);try{const t=await e.api.check();a(t)}catch(e){const t=e instanceof Error?e.message:"Failed to refresh license";throw c(t),e}finally{n(!1)}}}}function d({initialLicense:e,licenseConfig:t,licenseAPI:a,shouldRefreshPageOnLicenseChange:s=!0,shouldAutoRefreshLicenseOnMount:n=!1}){const{license:r,isLoading:c,error:i,activateLicense:o,deactivateLicense:d,refreshLicense:u}=p({initialLicense:e,api:a}),h=r&&"valid"===r.status,m=r?.license_key||null;return React.createElement("div",{className:"arts-license-pro-panel"},React.createElement(l,{onActivate:o,onDeactivate:d,onRefresh:u,isLoading:c,licenseKey:m,isActivated:!!h,license:r,apiError:i,licenseConfig:t,shouldRefreshPageOnLicenseChange:s,shouldAutoRefreshLicenseOnMount:n}))}class u{productSlug;ajaxUrl;nonce;constructor(e,t,a){this.productSlug=e,this.ajaxUrl=t,this.nonce=a}async activate(e){const t=new URLSearchParams({action:`${this.productSlug}_license_activate`,_wpnonce:this.nonce,license_key:e}),a=await fetch(this.ajaxUrl,{method:"POST",body:t}),s=await a.json();if(!s.success)throw new Error(s.data?.message||"Activation failed");return s.data}async deactivate(){const e=new URLSearchParams({action:`${this.productSlug}_license_deactivate`,_wpnonce:this.nonce}),t=await fetch(this.ajaxUrl,{method:"POST",body:e}),a=await t.json();if(!a.success)throw new Error(a.data?.message||"Deactivation failed")}async check(){const e=new URLSearchParams({action:`${this.productSlug}_license_check`,_wpnonce:this.nonce}),t=await fetch(this.ajaxUrl,{method:"POST",body:e}),a=await t.json();if(!a.success){if("No license found"===a.data?.message)return null;throw new Error(a.data?.message||"Check failed")}return a.data}}const{createElement:h,render:m}=wp.element;function f(){if(!window.artsLicenseProInstances)return;document.querySelectorAll(".arts-license-pro-license-panel-root").forEach((e=>{const t=e.getAttribute("data-product"),a=window.artsLicenseProInstances[t];if(!a)return;const s=new u(a.productSlug,a.ajaxUrl,a.nonce);m(h(d,{initialLicense:a.initialLicense,licenseConfig:a.config,licenseAPI:s}),e)}));document.querySelectorAll(".arts-license-pro-badge-root").forEach((e=>{const a=e.getAttribute("data-config");if(a)try{const s=JSON.parse(a);m(h(t,s),e)}catch(e){}}))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",f):f();export{u as LicenseAPIAdapter,l as LicenseForm,d as LicensePanel,t as ProBadge,p as useLicense};